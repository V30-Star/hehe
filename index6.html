<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Page 6 ‚Äî Erase to Love (Hard Mode)</title>
    <style>
      :root {
        --bg: #0b0e16;
        --ink: #eaf0ff;
        --muted: #9aa6bf;
        --card: #131a34;
        --border: #263056;
        --good: #1b8a57;
        --bad: #ef4444;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font: 16px/1.6 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
        color: var(--ink);
        background: var(--bg);
        padding: 20px;
      }
      .wrap {
        max-width: 1100px;
        margin: 0 auto;
      }
      header {
        display: flex;
        align-items: center;
        gap: 14px;
        margin: 2px 0 16px;
      }
      .logo {
        width: 52px;
        height: 52px;
        border-radius: 14px;
        display: grid;
        place-items: center;
        background: conic-gradient(from 230deg, #2c3b63, #1b2140 35%, #12162b 70%, #2c3b63);
        color: #cfe0ff;
        font-weight: 800;
      }
      h1 {
        margin: 0;
        font-size: clamp(22px, 3.4vw, 36px);
      }
      .subtitle {
        color: var(--muted);
      }
      .card {
        border: 1px solid #263056;
        border-radius: 18px;
        overflow: hidden;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0) 60%), var(--card);
      }
      .top {
        padding: 14px 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }
      /* ‚îÄ‚îÄ CLUE SAMAR: 5 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      body::after {
        content: "5";
        position: fixed;
        top: 55%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-8deg);
        font-size: clamp(50px, 10vw, 30px);
        font-weight: 400;
        color: #86e0ff;
        opacity: 0.05;
        filter: blur(1.5px);
        mix-blend-mode: screen;
        pointer-events: none;
        z-index: 0;
      }
      .badge {
        background: #121a39;
        border: 1px solid #2a3568;
        color: #d6e2ff;
        font-size: 12px;
        padding: 6px 10px;
        border-radius: 999px;
      }
      .top .right {
        margin-left: auto;
        color: #9fb0da;
      }
      .board-wrap {
        padding: 12px 16px 16px;
      }
      .chalk {
        width: 100%;
        max-width: 1000px;
        aspect-ratio: 5/3;
        display: block;
        margin: 0 auto;
        border-radius: 14px;
        border: 1px solid #2a3355;
        background: #14331f
          url('data:image/svg+xml;utf8,\
    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">\
      <rect width="40" height="40" fill="%2314331f"/>\
      <path d="M0 20 H40 M20 0 V40" stroke="%231d4c2f" stroke-width="1" opacity="0.35"/>\
    </svg>')
          center/40px 40px repeat;
        box-shadow: inset 0 0 60px rgba(0, 0, 0, 0.35);
      }
      .controls {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: center;
        padding: 10px 16px 18px;
      }
      .btn {
        padding: 10px 16px;
        border-radius: 12px;
        border: 1px solid #2a3355;
        background: #16204a;
        color: #cfe0ff;
        cursor: pointer;
        transition: 0.2s;
      }
      .btn:hover {
        transform: translateY(-1px);
      }
      .btn.primary {
        background: var(--good);
        border-color: var(--good);
        color: #fff;
      }
      .msg {
        text-align: center;
        color: #a8b4d8;
        padding: 0 16px 14px;
        min-height: 24px;
      }
      .msg.err {
        color: #ffc8cf;
      }
      .msg.ok {
        color: #b8ffd6;
      }
      .result {
        display: none;
        text-align: center;
        padding: 0 16px 18px;
      }
      .result h2 {
        margin: 8px 0 4px;
        font-size: 28px;
      }
      .love {
        font-size: 36px;
        letter-spacing: 2px;
        font-weight: 800;
      }
      .result.show {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="logo">P6</div>
        <div>
          <h1>Erase to Love</h1>
          <div class="subtitle">Hapus bagian ATAS dari angka di papan‚Äîtanpa garis bantu.</div>
        </div>
      </header>

      <article class="card">
        <div class="top">
          <span class="badge" id="status">Locked</span>
          <div class="right">Target: <code>128‚àöe980</code></div>
        </div>

        <div class="board-wrap">
          <canvas id="board" class="chalk"></canvas>
        </div>

        <div class="controls">
          <button id="erase" class="btn">‚úçÔ∏è Hapus</button>
          <button id="check" class="btn primary">Periksa</button>
          <button id="reset" class="btn">Reset</button>
        </div>

        <div id="message" class="msg"></div>

        <div id="result" class="result">
          <h2>YOU DID IT! üéâ</h2>
          <div class="love">I&nbsp;LOVE&nbsp;YOU</div>
          <a href="index7.html" class="btn primary" style="margin-top: 10px">Next ‚Üí</a>
        </div>
      </article>
    </div>

    <script>
      /* ===== Canvas setup ===== */
      const canvas = document.getElementById("board");
      const ctx = canvas.getContext("2d");
      const textMask = document.createElement("canvas");
      const eraseMask = document.createElement("canvas");
      const tx = textMask.getContext("2d");
      const ex = eraseMask.getContext("2d");

      function fitCanvas() {
        const w = Math.min(1000, canvas.parentElement.clientWidth);
        const h = Math.round(w * 0.6);
        [canvas, textMask, eraseMask].forEach((cv) => {
          cv.width = w;
          cv.height = h;
        });
      }
      fitCanvas();
      window.addEventListener("resize", () => {
        fitCanvas();
        drawAll();
      });

      function drawNumber() {
        tx.clearRect(0, 0, textMask.width, textMask.height);
        const w = textMask.width,
          h = textMask.height;
        const text = "128‚àöe980";
        const pad = Math.max(24, Math.round(w * 0.06));
        let fs = Math.floor(h * 0.66);
        tx.textAlign = "center";
        tx.textBaseline = "middle";
        tx.fillStyle = "#ffffff";
        function setAndMeasure(size) {
          tx.font = `700 ${size}px Arial, Helvetica, sans-serif`;
          const m = tx.measureText(text);
          const width = m.actualBoundingBoxLeft !== undefined && m.actualBoundingBoxRight !== undefined ? m.actualBoundingBoxLeft + m.actualBoundingBoxRight : m.width;
          return width;
        }
        let measured = setAndMeasure(fs),
          maxWidth = w - pad * 2;
        while (measured > maxWidth && fs > 10) {
          fs -= 2;
          measured = setAndMeasure(fs);
        }
        tx.fillText(text, w / 2, h * 0.58);
      }

      function drawAll() {
        const w = canvas.width,
          h = canvas.height;
        ctx.clearRect(0, 0, w, h);
        ctx.globalCompositeOperation = "source-over";
        ctx.drawImage(textMask, 0, 0);
        ctx.globalCompositeOperation = "destination-out";
        ctx.drawImage(eraseMask, 0, 0);
        ctx.globalCompositeOperation = "source-over";
      }

      function resetErase() {
        ex.clearRect(0, 0, eraseMask.width, eraseMask.height);
        drawAll();
        setMsg("");
        document.getElementById("status").textContent = "Locked";
        document.getElementById("result").classList.remove("show");
      }

      /* ===== Eraser (bebas atas/bawah) ===== */
      let erasing = false,
        eraseMode = false;
      function drawDot(x, y) {
        const r = Math.max(10, Math.floor(canvas.width * 0.02));
        ex.save();
        ex.globalCompositeOperation = "source-over";
        ex.fillStyle = "#ffffff";
        ex.beginPath();
        ex.arc(x, y, r, 0, Math.PI * 2);
        ex.fill();
        ex.restore();
      }
      function getXY(e) {
        const rect = canvas.getBoundingClientRect();
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: (cx - rect.left) * (canvas.width / rect.width), y: (cy - rect.top) * (canvas.height / rect.height) };
      }
      function onDown(e) {
        if (!eraseMode) return;
        erasing = true;
        const { x, y } = getXY(e);
        drawDot(x, y);
        drawAll();
      }
      function onMove(e) {
        if (!erasing) return;
        const { x, y } = getXY(e);
        drawDot(x, y);
        drawAll();
      }
      function onUp() {
        erasing = false;
      }

      document.getElementById("erase").onclick = () => {
        eraseMode = !eraseMode;
        setMsg(eraseMode ? "Mode hapus aktif." : "");
      };
      canvas.addEventListener("mousedown", onDown);
      canvas.addEventListener("mousemove", onMove);
      window.addEventListener("mouseup", onUp);
      canvas.addEventListener(
        "touchstart",
        (e) => {
          e.preventDefault();
          onDown(e);
        },
        { passive: false }
      );
      canvas.addEventListener(
        "touchmove",
        (e) => {
          e.preventDefault();
          onMove(e);
        },
        { passive: false }
      );
      canvas.addEventListener("touchend", onUp);

      /* ===== Validasi: atas >= 80% & bawah <= 20% ===== */
      function validate() {
        const w = canvas.width,
          h = canvas.height,
          mid = Math.floor(h / 2);
        const tD = tx.getImageData(0, 0, w, h).data;
        const eD = ex.getImageData(0, 0, w, h).data;
        let topText = 0,
          botText = 0,
          topErase = 0,
          botErase = 0;
        for (let y = 0; y < h; y += 2) {
          for (let x = 0; x < w; x += 2) {
            const i = (y * w + x) * 4;
            const t = tD[i + 3],
              e = eD[i + 3];
            if (t > 20) {
              if (y < mid) {
                topText++;
                if (e > 20) topErase++;
              } else {
                botText++;
                if (e > 20) botErase++;
              }
            }
          }
        }
        const pctTop = topText ? (topErase / topText) * 100 : 0;
        const pctBot = botText ? (botErase / botText) * 100 : 0;
        const pass = pctTop >= 80 && pctBot <= 20;
        return { pctTop: pctTop.toFixed(1), pctBot: pctBot.toFixed(1), pass };
      }
      document.getElementById("check").onclick = () => {
        const { pctTop, pctBot, pass } = validate();
        if (pass) {
          document.getElementById("status").textContent = "Unlocked";
          setMsg(`Atas ${pctTop}% ‚Äî bawah ${pctBot}% ‚Äî good.`, true);
          document.getElementById("result").classList.add("show");
        } else {
          setMsg(`Belum tepat. Atas ${pctTop}% ‚Ä¢ Bawah ${pctBot}%`, false, true);
        }
      };
      document.getElementById("reset").onclick = resetErase;

      function setMsg(t, ok = false, err = false) {
        const m = document.getElementById("message");
        m.textContent = t;
        m.classList.toggle("ok", ok);
        m.classList.toggle("err", err);
      }

      /* Boot */
      drawNumber();
      drawAll();
    </script>
  </body>
</html>
